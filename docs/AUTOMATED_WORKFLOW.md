# Automated Subtitle Translation Workflow

Simple automated translation using Claude Code only - no API keys or external dependencies needed.

## Fully Automated Workflow

```bash
# 1. Setup movie project
mkdir movies/My_Movie_2023
cp subtitle_file.srt movies/My_Movie_2023/My_Movie_2023_EN.srt

# 2. Generate metadata automatically (NEW!)
python tools/analyze_movie.py movies/My_Movie_2023 analyze

# 3. Generate chunks and prompts with rich context
python tools/prep_translation.py movies/My_Movie_2023

# 4. Automated translation
python tools/translate_batch.py movies/My_Movie_2023 translate

# 5. Assemble final Romanian subtitles
python tools/reassemble_translation.py movies/My_Movie_2023 assemble
```

**Result:** Complete subtitle translation with zero manual Claude Code interaction!

## How the Complete Automation Works

### 0. Automated Metadata Generation (NEW!)
- **analyze_movie.py** reads subtitle content automatically
- Uses Claude Code to analyze story, characters, themes, and cultural elements
- Generates structured `metadata.json` with translation guidance
- JSON validation ensures proper format

### 1. Context Injection via CLAUDE.md
- **prep_translation.py** creates `CLAUDE.md` in movie folder
- Contains rich story context from metadata analysis
- Claude Code automatically reads this when processing chunks
- Provides persistent context across all translations

### 2. Pre-Generated Prompts
- Each chunk gets its own prompt file: `translation_prompts/prompt_chunk_XX.txt`
- Context already injected - no manual copy/paste needed
- Ready-to-use with Claude Code directly

### 3. Batch Processing
- **translate_batch.py** processes all chunks automatically
- Uses subprocess to call Claude Code for each chunk
- Saves translations with correct naming: `translated/chunk_XX_RO.txt`
- Resume capability - continues from where it left off

## Generated File Structure

```
movies/My_Movie_2023/
├── My_Movie_2023_EN.srt         # Your original subtitle file
├── metadata.json                # Analysis data (optional)
├── CLAUDE.md                    # Context for Claude Code (auto-generated)
├── chunks/                      # Reference chunks and templates
├── translation_prompts/         # Ready-to-use prompts (auto-generated)
│   ├── prompt_chunk_01.txt
│   ├── prompt_chunk_02.txt
│   └── ...
├── translated/                  # Auto-saved translations
│   ├── chunk_01_RO.txt         # Generated by translate_batch.py
│   ├── chunk_02_RO.txt
│   └── ...
└── My_Movie_2023_RO.srt        # Final result (from reassemble)
```

## Batch Translation Commands

### Progress Tracking
```bash
python tools/translate_batch.py movies/My_Movie progress
```
Output:
```
Translation Progress for My_Movie:
Completed: 3/12 (25.0%)
Missing chunks: [4, 5, 6, 7, 8, 9, 10, 11, 12]
```

### Full Automation
```bash
# Translate all chunks
python tools/translate_batch.py movies/My_Movie translate

# Different Claude Code command
python tools/translate_batch.py movies/My_Movie translate --claude-cmd "claude"

# Start fresh (ignore existing translations)
python tools/translate_batch.py movies/My_Movie translate --no-resume
```

## Key Features

### ✅ **Context Persistence**
- CLAUDE.md provides story context for every translation
- No need to manually inject context into each prompt
- Consistent translation quality across all chunks

### ✅ **Resume Capability**
- Interrupted translations can be resumed
- Skips already completed chunks
- Progress is saved automatically

### ✅ **Error Handling**
- Individual chunk failures don't stop the process
- Clear error messages for debugging
- 5-minute timeout per chunk to prevent hanging

### ✅ **Progress Monitoring**
- Real-time progress updates during translation
- Easy to see which chunks are missing
- Clear completion status

## Manual Override

You can still translate manually if needed:

1. **Review context**: Check `CLAUDE.md` for story background
2. **Use pre-made prompts**: Copy from `translation_prompts/prompt_chunk_XX.txt`
3. **Paste into Claude Code**: Get translation
4. **Save as**: `translated/chunk_XX_RO.txt`

## Tips for Best Results

### Before Translation:
- **Always generate metadata** using `tools/analyze_subtitles_prompt.md`
- **Review CLAUDE.md** to ensure context accuracy
- **Check chunk count** matches expected number

### During Translation:
- **Monitor progress** with progress command
- **Let it run uninterrupted** for best results
- **Resume if needed** - all progress is saved

### Troubleshooting:
- **Check Claude Code installation**: `claude-code --version`
- **Verify file permissions**: Ensure write access to movie folder
- **Check internet connection**: Required for Claude Code API
- **Use different command**: Try `--claude-cmd "claude"` if default fails

## Performance Notes

- **Speed**: ~2-3 minutes per chunk (depends on content length)
- **Reliability**: Automatic retry on timeout, progress saving
- **Scalability**: Can handle any number of chunks
- **Resources**: Minimal CPU/memory usage

This automation eliminates the tedious manual copy-paste workflow while maintaining translation quality through intelligent context management.